<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مواقيت الصلاة</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  body {
    margin: 0;
    font-family: "Cairo", sans-serif;
    background: linear-gradient(120deg, #0f2027, #203a43, #2c5364);
    background-size: 400% 400%;
    animation: gradientBG 12s ease infinite;
    color: #fff;
    text-align: center;
    direction: rtl;
  }
  @keyframes gradientBG {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }
  h1 {margin-top:30px; font-size:42px; font-weight:bold; text-shadow:0 0 20px rgba(255,255,255,0.5);}
  .card {
    backdrop-filter: blur(12px);
    background: rgba(255,255,255,0.1);
    border-radius:20px;
    padding:25px;
    margin:20px auto;
    width:90%;
    max-width:800px;
    box-shadow:0 8px 30px rgba(0,0,0,0.5);
  }
  select, button {
    padding:14px;
    margin:10px;
    border-radius:12px;
    border:none;
    font-size:18px;
    cursor:pointer;
  }
  select {width:90%; max-width:300px;}
  button {background:#f39c12; color:#fff; font-weight:bold; transition:0.3s;}
  button:hover {background:#e67e22;}
  table {margin:20px auto; border-collapse:collapse; width:100%;}
  th, td {padding:16px; border-bottom:1px solid rgba(255,255,255,0.2); font-size:20px;}
  th {background: rgba(255,255,255,0.15);}
  td i {margin-left:10px; color:#f1c40f;}
  .next-prayer {margin-top:20px; font-size:28px; font-weight:bold; color:#2ecc71; text-shadow:0 0 12px rgba(46,204,113,0.7);}
  .countdown {font-size:34px; margin-top:10px; font-weight:bold; color:#f39c12;}
  .modal {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.85);
    justify-content:center;
    align-items:center;
    z-index:1000;
  }
  .modal-content {
    background:#fff; color:#333;
    padding:30px;
    border-radius:20px;
    text-align:center;
    width:85%; max-width:400px;
    box-shadow:0 10px 40px rgba(0,0,0,0.5);
  }
  .modal-content h2 {margin-bottom:15px;}
  .modal-content button {background:#2ecc71; color:#fff; font-size:18px; padding:10px 20px; border-radius:10px;}
  .footer {margin-top:30px; font-size:14px; color:rgba(255,255,255,0.6);}
  @media (max-width:600px) {
    h1 {font-size:32px;}
    .next-prayer {font-size:24px;}
    .countdown {font-size:28px;}
    th, td {font-size:18px; padding:12px;}
    select, button {font-size:16px; padding:12px;}
  }
</style>
</head>
<body>
<h1>🌙 مواقيت الصلاة</h1>

<div class="card">
  <label for="city">اختر المدينة:</label><br>
  <select id="city">
    <optgroup label="🇹🇷 تركيا">
      <option value="Istanbul">إسطنبول</option>
      <option value="Ankara">أنقرة</option>
      <option value="Izmir">إزمير</option>
      <option value="Adiyaman">أديامان</option>
      <option value="Gaziantep">غازي عنتاب</option>
      <option value="Bursa">بورصة</option>
      <option value="Antalya">أنطاليا</option>
      <option value="Konya">قونية</option>
      <option value="Kayseri">قيصري</option>
      <option value="Trabzon">طرابزون</option>
      <option value="Sanliurfa">شانلي أورفا</option>
      <option value="Mardin">ماردين</option>
      <option value="Hatay">هاتاي</option>
      <option value="Malatya">ملاطية</option>
      <option value="Diyarbakir">ديار بكر</option>
      <option value="Van">وان</option>
      <option value="Erzurum">أرضروم</option>
      <option value="Samsun">سامسون</option>
      <option value="Adana">أضنة</option>
      <option value="Eskisehir">أسكي شهير</option>
    </optgroup>
    <optgroup label="🇸🇾 سوريا">
      <option value="Damascus">دمشق</option>
      <option value="Aleppo">حلب</option>
      <option value="Homs">حمص</option>
      <option value="Latakia">اللاذقية</option>
      <option value="Hama">حماة</option>
      <option value="Idlib">إدلب</option>
      <option value="Daraa">درعا</option>
      <option value="Raqqa">الرقة</option>
      <option value="Deir Ezzor">دير الزور</option>
      <option value="Hasakah">الحسكة</option>
    </optgroup>
  </select><br>
  <button onclick="getPrayerTimes()">عرض الأوقات</button>
</div>

<div class="card" id="prayerCard" style="display:none;">
  <table id="prayerTable">
    <thead><tr><th>الصلاة</th><th>الوقت</th></tr></thead>
    <tbody></tbody>
  </table>
  <div class="next-prayer" id="nextPrayer"></div>
  <div class="countdown" id="countdown"></div>
</div>

<div class="modal" id="adhanModal">
  <div class="modal-content">
    <h2>🕌 حان وقت الصلاة</h2>
    <p id="modalPrayer"></p>
    <button onclick="closeModal()">حسناً</button>
  </div>
</div>

<audio id="adhanAudio" src="https://www.islamcan.com/audio/adhan/azan1.mp3"></audio>
<div class="footer">© 2025     جميع الحقوق محفوظة | منصور الحجي  </div>

<script>
let countdownInterval;

async function getPrayerTimes() {
  let city = document.getElementById("city").value;
  let country = cityInSyria(city) ? "Syria" : "Turkey";
  let method = country==="Turkey"?12:4;
  let url = `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=${country}&method=${method}&school=0`;
  try {
    let res = await fetch(url);
    let data = await res.json();
    if(!data.data) {alert("خطأ في جلب الأوقات"); return;}
    let timings = data.data.timings;
    let tbody = document.querySelector("#prayerTable tbody");
    tbody.innerHTML = "";
    let prayers = {
      Fajr:{name:"الفجر", icon:"fa-moon"},
      Sunrise:{name:"الشروق", icon:"fa-sun"},
      Dhuhr:{name:"الظهر", icon:"fa-sun"},
      Asr:{name:"العصر", icon:"fa-cloud-sun"},
      Maghrib:{name:"المغرب", icon:"fa-sunset"},
      Isha:{name:"العشاء", icon:"fa-moon-stars"}
    };
    for(let key in prayers){
      tbody.innerHTML+=`<tr><td><i class="fa-solid ${prayers[key].icon}"></i>${prayers[key].name}</td><td>${timings[key]}</td></tr>`;
    }
    document.getElementById("prayerCard").style.display="block";
    checkNextPrayer(timings);
  } catch(err){
    alert("فشل الاتصال بالـ API");
    console.error(err);
  }
}

function checkNextPrayer(timings){
  clearInterval(countdownInterval);
  let now=new Date();
  let currentMinutes=now.getHours()*60+now.getMinutes();
  let prayersOrder=[
    {key:"Fajr", name:"الفجر"},
    {key:"Dhuhr", name:"الظهر"},
    {key:"Asr", name:"العصر"},
    {key:"Maghrib", name:"المغرب"},
    {key:"Isha", name:"العشاء"}
  ];
  let nextPrayer=null;
  for(let p of prayersOrder){
    let [h,m]=timings[p.key].split(":").map(Number);
    let prayerMinutes=h*60+m;
    if(prayerMinutes>currentMinutes){
      nextPrayer={...p,time:timings[p.key],minutes:prayerMinutes};
      break;
    }
  }
  if(!nextPrayer){nextPrayer={key:"Fajr",name:"الفجر",time:timings["Fajr"],minutes:null};}
  document.getElementById("nextPrayer").innerText=`🕌 الصلاة القادمة: ${nextPrayer.name} - ${nextPrayer.time}`;
  if(nextPrayer.minutes){
    countdownInterval=setInterval(()=>{
      let now=new Date();
      let diff=(nextPrayer.minutes*60-(now.getHours()*3600+now.getMinutes()*60+now.getSeconds()));
      if(diff<=0){clearInterval(countdownInterval); playAdhan(nextPrayer.name); return;}
      let h=Math.floor(diff/3600);
      let m=Math.floor((diff%3600)/60);
      let s=diff%60;
      document.getElementById("countdown").innerText=`⏳ متبقي: ${h.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
    },1000);
  }
}

function playAdhan(prayerName){
  document.getElementById("adhanAudio").play();
  document.getElementById("modalPrayer").innerText="صلاة "+prayerName;
  document.getElementById("adhanModal").style.display="flex";
}

function closeModal(){document.getElementById("adhanModal").style.display="none";}

function cityInSyria(city){
  let syria=["Damascus","Aleppo","Homs","Latakia","Hama","Idlib","Daraa","Raqqa","Deir Ezzor","Hasakah"];
  return syria.includes(city);
}
</script>
</body>
</html>